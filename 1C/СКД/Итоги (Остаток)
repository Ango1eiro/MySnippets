Если в макете компоновки данных в некотором наборе данных присутствует поле начального остатка, то в наборе данных также должно присутствовать соответствующее ему поле конечного остатка, и наоборот.

Все поля-периоды, описанные в наборе данных, должны иметь непрерывную нумерацию, начинающуюся с единицы.

Для корректного расчета итогов по полям источника данных данные должны удовлетворять следующему правилу: в данных должна соблюдаться уникальность значений полей-периодов и полей-измерений, т. е. данные не должны содержать строк с одинаковыми значениями полей-периодов и полей-измерений.

При расчете итогов по полям-остаткам используется следующий алгоритм:

● если требуется осуществить расчет итога поля остатка для группировки по полю-периоду:

● если по всем полям-периодам уже была осуществлена группировка:

● для каждой комбинации полей измерений, по которым осуществлялась группировка:

● получается запись, ближайшая к текущему периоду;

● если полученная запись была на текущий период, то из данной записи будут получаться начальные и конечные остатки;

● иначе, если полученная запись имеет предыдущий период, конечный остаток записи будет использован как начальный и конечный остаток;

● иначе начальный остаток полученной записи будет использоваться как начальный и конечный остаток;

● иначе (группировка еще не произведена по всем полям-периодам):

● для каждой комбинации полей измерений, по которым осуществлялась группировка:

● получаются первая и последние записи, у которых поля использованных периодов равны текущему периоду;

● если записи найдены, то первая запись будет использоваться как начальный остаток, последняя ‑ как конечный;

● если записи не найдены, то получается ближайшая запись и ее остатки используются как начальные остатки и конченые остатки в зависимости от того, предшествует ли найденная запись текущему периоду;

● иначе (не группировка по полю-периоду):

● первые по хронологии записи для неиспользованных полей-измерений будут использоваться в качестве записей начального остатка, последние ‑ в качестве конечного.
